// same logic from previous script, skipped for brevity